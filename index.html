<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BNB Smart Chain USDT Transfer</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.3/dist/ethers.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    input, button {
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.5rem;
      background-color: #1e1e1e;
      color: #f1f1f1;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
    }
    button {
      background-color: #f0b90b;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
    }
    #status, #txHash, #balanceResult, #decodeResult {
      margin-top: 1rem;
      background-color: #1e1e1e;
      padding: 1rem;
      border-radius: 6px;
      word-break: break-word;
      white-space: pre-line;
      font-family: monospace;
    }
    h1 {
      color: #f0b90b;
      text-align: center;
    }
    label {
      margin-top: 1rem;
      display: block;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>BNB Smart Chain USDT Transfer</h1>

<button id="connectBtn">üîå Connect Wallet</button>
<div id="status">Wallet not connected.</div>

<label for="recipient">Recipient Address</label>
<input type="text" id="recipient" placeholder="0x..." autocomplete="off" />

<label for="amount">Amount (USDT)</label>
<input type="number" id="amount" value="1" min="0" step="0.01" autocomplete="off" />

<button id="sendBtn" disabled>üöÄ Send USDT</button>
<div id="txHash"></div>

<hr style="margin: 2rem 0; border-color: #333;"/>

<button id="checkBalanceBtn" disabled>üîç Check USDT Balance</button>
<div id="balanceResult"></div>

<h3>Decode Transaction</h3>
<input type="text" id="hashInput" placeholder="0x transaction hash" autocomplete="off" />
<button id="decodeBtn">üîé Decode</button>
<div id="decodeResult"></div>

<script>
  const USDT_ADDRESS = "0x55d398326f99059ff775485246999027b3197955"; // BSC USDT
  const USDT_ABI = [
    "function transfer(address to, uint256 amount) returns (bool)",
    "function balanceOf(address account) view returns (uint256)"
  ];
  
  let provider;
  let signer;
  let usdtContract;
  let userAddress;

  const connectBtn = document.getElementById("connectBtn");
  const sendBtn = document.getElementById("sendBtn");
  const status = document.getElementById("status");
  const txHash = document.getElementById("txHash");
  const checkBalanceBtn = document.getElementById("checkBalanceBtn");
  const balanceResult = document.getElementById("balanceResult");
  const decodeBtn = document.getElementById("decodeBtn");
  const decodeResult = document.getElementById("decodeResult");

  // Helper: shorten wallet address
  function shortenAddress(addr) {
    return addr.slice(0,6) + "..." + addr.slice(-4);
  }

  async function connectWallet() {
    if (!window.ethereum) {
      status.textContent = "MetaMask not found. Please install MetaMask.";
      return;
    }

    try {
      provider = new ethers.BrowserProvider(window.ethereum);
      await window.ethereum.request({ method: "eth_requestAccounts" });
      signer = await provider.getSigner();
      userAddress = await signer.getAddress();

      const network = await provider.getNetwork();
      if (network.chainId !== 56) {
        // Switch to BSC
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x38" }]
        });
      }

      // Create contract with signer for sending
      usdtContract = new ethers.Contract(USDT_ADDRESS, USDT_ABI, signer);

      status.textContent = `Connected: ${shortenAddress(userAddress)}`;
      sendBtn.disabled = false;
      checkBalanceBtn.disabled = false;
      connectBtn.disabled = true;

    } catch (err) {
      console.error(err);
      status.textContent = "Connection failed: " + err.message;
    }
  }

  async function sendUSDT() {
    const to = document.getElementById("recipient").value.trim();
    const amountStr = document.getElementById("amount").value.trim();

    txHash.textContent = "";
    if (!signer) return alert("Please connect your wallet first.");
    if (!ethers.isAddress(to)) return alert("Invalid recipient address.");
    if (!amountStr || isNaN(amountStr) || Number(amountStr) <= 0) return alert("Enter a valid positive amount.");

    try {
      const amount = ethers.parseUnits(amountStr, 18);
      sendBtn.disabled = true;
      txHash.textContent = "Sending transaction...";

      const tx = await usdtContract.transfer(to, amount);
      txHash.textContent = `Transaction sent: ${tx.hash}\nWaiting for confirmation...`;
      await tx.wait();

      txHash.textContent = `‚úÖ Transaction confirmed!\nHash: ${tx.hash}`;
    } catch (err) {
      console.error(err);
      txHash.textContent = `‚ùå Error: ${err.message}`;
    } finally {
      sendBtn.disabled = false;
    }
  }

  async function checkBalance() {
    const address = document.getElementById("recipient").value.trim();
    balanceResult.textContent = "";

    if (!address || !ethers.isAddress(address)) {
      balanceResult.textContent = "Please enter a valid address to check balance.";
      return;
    }

    try {
      // Use provider-only contract for read-only calls
      if (!provider) provider = new ethers.BrowserProvider(window.ethereum);
      const readOnlyContract = new ethers.Contract(USDT_ADDRESS, USDT_ABI, provider);
      const balance = await readOnlyContract.balanceOf(address);
      balanceResult.textContent = `USDT Balance of ${shortenAddress(address)}: ${ethers.formatUnits(balance, 18)} USDT`;
    } catch (err) {
      console.error(err);
      balanceResult.textContent = "Error checking balance: " + err.message;
    }
  }

  async function decodeTransaction() {
    const hash = document.getElementById("hashInput").value.trim();
    decodeResult.textContent = "";

    if (!hash.startsWith("0x") || hash.length !== 66) {
      decodeResult.textContent = "Please enter a valid 66-character transaction hash.";
      return;
    }

    try {
      if (!provider) provider = new ethers.BrowserProvider(window.ethereum);
      const tx = await provider.getTransaction(hash);

      if (!tx) {
        decodeResult.textContent = "Transaction not found.";
        return;
      }

      let output = `From: ${tx.from}\nTo: ${tx.to}\nValue: ${ethers.formatEther(tx.value)} BNB\nHash: ${tx.hash}`;

      // Decode input if token transfer
      if (tx.data && tx.data !== "0x") {
        const iface = new ethers.Interface(USDT_ABI);
        try {
          const decoded = iface.parseTransaction({ data: tx.data, value: tx.value });
          output += `\n\nMethod: ${decoded.name}\nParameters: ${JSON.stringify(decoded.args, null, 2)}`;
        } catch {
          output += `\n\n(Unable to decode input data)`;
        }
      }

      decodeResult.textContent = output;
    } catch (err) {
      decodeResult.textContent = "Error: " + err.message;
    }
  }

  // Attach event listeners
  connectBtn.onclick = connectWallet;
  sendBtn.onclick = sendUSDT;
  checkBalanceBtn.onclick = checkBalance;
  decodeBtn.onclick = decodeTransaction;
</script>

</body>
</html>
