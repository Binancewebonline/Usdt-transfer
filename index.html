<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BNB USDT Transfer</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.3/dist/ethers.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    input, button {
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.5rem;
      background-color: #1e1e1e;
      color: #f1f1f1;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
    }
    button {
      background-color: #f0b90b;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    #status, #txHash, #balanceResult, #decodeResult {
      margin-top: 1rem;
      background-color: #1e1e1e;
      padding: 1rem;
      border-radius: 6px;
      word-break: break-word;
    }
    h1 {
      color: #f0b90b;
    }
  </style>
</head>
<body>

<h1>BNB Smart Chain USDT Transfer</h1>

<button onclick="connectWallet()">üîå Connect Wallet</button>
<div id="status">Wallet not connected.</div>

<label>Recipient Address</label>
<input type="text" id="recipient" placeholder="0x..." />

<label>Amount (USDT)</label>
<input type="number" id="amount" value="2778.78" step="0.01" />

<button onclick="sendUSDT()">üöÄ Send USDT</button>
<div id="txHash"></div>

<button onclick="checkBalance()">üîç Check USDT Balance</button>
<div id="balanceResult"></div>

<h3>Decode Transaction</h3>
<input type="text" id="hashInput" placeholder="0x transaction hash" />
<button onclick="decodeTransaction()">üîé Decode</button>
<div id="decodeResult"></div>

<script>
  const USDT_ADDRESS = "0x55d398326f99059ff775485246999027b3197955"; // BSC USDT
  const USDT_ABI = [
    "function transfer(address to, uint256 amount) returns (bool)",
    "function balanceOf(address account) view returns (uint256)"
  ];
  let provider, signer, usdtContract, userAddress;

  async function connectWallet() {
    const status = document.getElementById("status");

    if (!window.ethereum) {
      status.textContent = "MetaMask not found.";
      return;
    }

    try {
      provider = new ethers.BrowserProvider(window.ethereum);
      await window.ethereum.request({ method: "eth_requestAccounts" });
      signer = await provider.getSigner();
      userAddress = await signer.getAddress();

      const { chainId } = await provider.getNetwork();
      if (chainId !== 56) {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x38" }]
        });
      }

      usdtContract = new ethers.Contract(USDT_ADDRESS, USDT_ABI, signer);
      document.getElementById("status").textContent = `Connected: ${userAddress}`;
    } catch (err) {
      console.error(err);
      status.textContent = "Connection failed: " + err.message;
    }
  }

  async function sendUSDT() {
    const to = document.getElementById("recipient").value.trim();
    const amount = document.getElementById("amount").value.trim();
    const txHash = document.getElementById("txHash");

    if (!signer) return alert("Please connect wallet first.");
    if (!ethers.isAddress(to)) return alert("Invalid address.");
    if (!amount || isNaN(amount)) return alert("Invalid amount.");

    try {
      const value = ethers.parseUnits(amount, 18);
      const tx = await usdtContract.transfer(to, value);
      txHash.textContent = "Sending... Tx: " + tx.hash;
      await tx.wait();
      txHash.textContent = "‚úÖ Confirmed! Tx: " + tx.hash;
    } catch (err) {
      console.error(err);
      txHash.textContent = "‚ùå Error: " + err.message;
    }
  }

  async function checkBalance() {
    const address = document.getElementById("recipient").value.trim();
    const result = document.getElementById("balanceResult");

    if (!ethers.isAddress(address)) return result.textContent = "Invalid address";

    try {
      const balance = await usdtContract.balanceOf(address);
      result.textContent = "USDT Balance: " + ethers.formatUnits(balance, 18);
    } catch (err) {
      console.error(err);
      result.textContent = "Error checking balance";
    }
  }

  async function decodeTransaction() {
    const hash = document.getElementById("hashInput").value.trim();
    const output = document.getElementById("decodeResult");

    if (!provider || !hash.startsWith("0x")) return;

    try {
      const tx = await provider.getTransaction(hash);
      if (!tx) return output.textContent = "Transaction not found";

      let summary = `From: ${tx.from}\nTo: ${tx.to}\nValue: ${ethers.formatEther(tx.value)} BNB\nHash: ${tx.hash}`;
      output.textContent = summary;
    } catch (err) {
      output.textContent = "Error: " + err.message;
    }
  }
</script>

</body>
</html>
